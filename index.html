<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visual Mongoose References Guide</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .database-visual {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin: 40px 0;
        flex-wrap: wrap;
        gap: 20px;
      }

      .collection {
        background: linear-gradient(145deg, #f0f2f5, #e1e8ed);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        min-width: 280px;
        transition: transform 0.3s ease;
      }

      .collection:hover {
        transform: translateY(-5px);
      }

      .collection-header {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 18px;
      }

      .document {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 15px;
        margin: 10px 0;
        position: relative;
        transition: all 0.3s ease;
      }

      .document:hover {
        border-color: #4caf50;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
      }

      .field {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
      }

      .field:last-child {
        border-bottom: none;
      }

      .field-name {
        font-weight: bold;
        color: #2196f3;
      }

      .field-value {
        color: #333;
        font-family: "Courier New", monospace;
      }

      .object-id {
        background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
        color: white;
        padding: 4px 8px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
      }

      .reference-line {
        position: absolute;
        height: 3px;
        background: linear-gradient(90deg, #ff6b6b, #4caf50);
        border-radius: 3px;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
      }

      .arrow {
        color: #ff6b6b;
        font-size: 24px;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateX(0);
        }
        50% {
          transform: translateX(10px);
        }
      }

      .code-section {
        background: #1a1a1a;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        position: relative;
      }

      .code-header {
        color: #4caf50;
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 16px;
      }

      .code {
        color: #f8f8f2;
        font-family: "Courier New", monospace;
        line-height: 1.8;
        white-space: pre-wrap;
      }

      .keyword {
        color: #66d9ef;
      }
      .string {
        color: #a6e22e;
      }
      .comment {
        color: #75715e;
      }
      .number {
        color: #ae81ff;
      }

      .step-visual {
        display: grid;
        grid-template-columns: 1fr 50px 1fr;
        gap: 20px;
        align-items: center;
        margin: 30px 0;
      }

      .step-box {
        background: linear-gradient(145deg, #667eea, #764ba2);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
      }

      .step-number {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 10px;
        font-weight: bold;
        font-size: 18px;
      }

      .population-demo {
        background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
        border-radius: 15px;
        padding: 25px;
        margin: 20px 0;
      }

      .before-after {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 20px;
      }

      .before,
      .after {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .before h4,
      .after h4 {
        color: #333;
        margin-bottom: 15px;
        text-align: center;
      }

      .interactive-button {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 20px 10px;
      }

      .interactive-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
      }

      .highlight {
        background: linear-gradient(45deg, #ffe082, #ffeb3b);
        padding: 2px 6px;
        border-radius: 4px;
        animation: highlight-flash 2s ease-in-out;
      }

      @keyframes highlight-flash {
        0%,
        100% {
          background: linear-gradient(45deg, #ffe082, #ffeb3b);
        }
        50% {
          background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
        }
      }

      .relationship-diagram {
        text-align: center;
        margin: 40px 0;
      }

      .entity {
        display: inline-block;
        background: white;
        border: 3px solid #4caf50;
        border-radius: 15px;
        padding: 20px;
        margin: 20px;
        min-width: 150px;
        position: relative;
      }

      .entity-title {
        font-weight: bold;
        color: #4caf50;
        font-size: 18px;
        margin-bottom: 10px;
      }

      .connector {
        position: absolute;
        top: 50%;
        right: -40px;
        font-size: 24px;
        color: #ff6b6b;
      }

      @media (max-width: 768px) {
        .database-visual {
          flex-direction: column;
        }

        .step-visual {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .before-after {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üé® Visual Guide to Mongoose References</h1>
        <p>Understanding database relationships with interactive examples</p>
      </div>

      <!-- Basic Concept -->
      <div class="section">
        <h2>üîó What Are References?</h2>
        <p style="font-size: 18px; margin-bottom: 30px">
          References connect different collections together, like linking users
          to their todos!
        </p>

        <div class="relationship-diagram">
          <div class="entity">
            <div class="entity-title">üë§ User</div>
            <div>John Doe</div>
            <div>john@email.com</div>
            <div class="connector">‚Üí</div>
          </div>
          <div class="entity">
            <div class="entity-title">üìù Todo</div>
            <div>Learn Mongoose</div>
            <div>Created by John</div>
          </div>
        </div>
      </div>

      <!-- Database Structure -->
      <div class="section">
        <h2>üóÑÔ∏è How It Looks in the Database</h2>
        <div class="database-visual">
          <div class="collection">
            <div class="collection-header">üë• Users Collection</div>
            <div class="document" id="user-doc">
              <div class="field">
                <span class="field-name">_id:</span>
                <span class="field-value object-id"
                  >507f1f77bcf86cd799439011</span
                >
              </div>
              <div class="field">
                <span class="field-name">name:</span>
                <span class="field-value">"John Doe"</span>
              </div>
              <div class="field">
                <span class="field-name">email:</span>
                <span class="field-value">"john@email.com"</span>
              </div>
            </div>
          </div>

          <div class="arrow">‚Üí</div>

          <div class="collection">
            <div class="collection-header">üìù Todos Collection</div>
            <div class="document" id="todo-doc">
              <div class="field">
                <span class="field-name">_id:</span>
                <span class="field-value object-id"
                  >507f1f77bcf86cd799439012</span
                >
              </div>
              <div class="field">
                <span class="field-name">title:</span>
                <span class="field-value">"Learn Mongoose"</span>
              </div>
              <div class="field">
                <span class="field-name">userId:</span>
                <span class="field-value object-id" id="reference-id"
                  >507f1f77bcf86cd799439011</span
                >
              </div>
              <div class="field">
                <span class="field-name">completed:</span>
                <span class="field-value">false</span>
              </div>
            </div>
          </div>
        </div>
        <p style="text-align: center; color: #666; margin-top: 20px">
          üëÜ Notice how the Todo's <strong>userId</strong> matches the User's
          <strong>_id</strong>
        </p>
      </div>

      <!-- Step by Step -->
      <div class="section">
        <h2>üìã Step-by-Step: Creating References</h2>

        <div class="step-visual">
          <div class="step-box">
            <div class="step-number">1</div>
            <h4>Create Schema</h4>
            <p>Define your models with reference fields</p>
          </div>
          <div class="arrow">‚Üí</div>
          <div class="step-box">
            <div class="step-number">2</div>
            <h4>Save Documents</h4>
            <p>Store the ObjectId as reference</p>
          </div>
        </div>

        <div class="code-section">
          <div class="code-header">üìÑ User Schema</div>
          <div class="code">
            <span class="keyword">const</span> userSchema =
            <span class="keyword">new</span> mongoose.Schema({
            <span class="string">name</span>: String,
            <span class="string">email</span>: String });

            <span class="keyword">const</span> User = mongoose.model(<span
              class="string"
              >'User'</span
            >, userSchema);
          </div>
        </div>

        <div class="code-section">
          <div class="code-header">üìÑ Todo Schema (with Reference)</div>
          <div class="code">
            <span class="keyword">const</span> todoSchema =
            <span class="keyword">new</span> mongoose.Schema({
            <span class="string">title</span>: String,
            <span class="string">completed</span>: Boolean,
            <span class="comment">// This creates the reference! üëá</span>
            <span class="string">userId</span>: {
            <span class="string">type</span>: mongoose.Schema.Types.ObjectId,
            <span class="string">ref</span>: <span class="string">'User'</span>
            <span class="comment">// Points to User model</span>
            } });

            <span class="keyword">const</span> Todo = mongoose.model(<span
              class="string"
              >'Todo'</span
            >, todoSchema);
          </div>
        </div>
      </div>

      <!-- Population Demo -->
      <div class="section">
        <h2>üîÑ Population: Bringing Data Together</h2>
        <p style="font-size: 18px; margin-bottom: 20px">
          Population automatically replaces ObjectIds with actual data!
        </p>

        <button class="interactive-button" onclick="showPopulation()">
          üéØ See Population in Action
        </button>

        <div class="population-demo">
          <h3 style="text-align: center; margin-bottom: 20px">
            Without vs With Population
          </h3>
          <div class="before-after">
            <div class="before" id="before-population">
              <h4>‚ùå Without .populate()</h4>
              <div class="code" style="color: #333">
                { title: "Learn Mongoose", userId: "507f1f77bcf86cd799439011",
                completed: false }
              </div>
              <p style="margin-top: 10px; color: #666">
                You only get the ObjectId üòï
              </p>
            </div>
            <div class="after" id="after-population">
              <h4>‚úÖ With .populate('userId')</h4>
              <div class="code" style="color: #333">
                { title: "Learn Mongoose", userId: { _id:
                "507f1f77bcf86cd799439011", name: "John Doe", email:
                "john@email.com" }, completed: false }
              </div>
              <p style="margin-top: 10px; color: #666">Full user data! üéâ</p>
            </div>
          </div>
        </div>

        <div class="code-section">
          <div class="code-header">üíª Population Code</div>
          <div class="code">
            <span class="comment">// Without population</span>
            <span class="keyword">const</span> todos =
            <span class="keyword">await</span> Todo.find();

            <span class="comment"
              >// With population - replaces userId with full user data</span
            >
            <span class="keyword">const</span> todos =
            <span class="keyword">await</span> Todo.find().<span
              class="highlight"
              >populate(<span class="string">'userId'</span>)</span
            >;

            <span class="comment"
              >// Selective population - only get specific fields</span
            >
            <span class="keyword">const</span> todos =
            <span class="keyword">await</span> Todo.find() .<span
              class="highlight"
              >populate(<span class="string">'userId'</span>,
              <span class="string">'name email'</span>)</span
            >;
          </div>
        </div>
      </div>

      <!-- Common Patterns -->
      <div class="section">
        <h2>üéØ Common Reference Patterns</h2>

        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
          "
        >
          <div class="step-box" style="height: auto">
            <h4>One-to-Many</h4>
            <p>One User ‚Üí Many Todos</p>
            <div style="margin-top: 15px; font-size: 14px">
              User stores no references<br />
              Each Todo stores userId
            </div>
          </div>

          <div class="step-box" style="height: auto">
            <h4>Many-to-Many</h4>
            <p>Users ‚Üî Projects</p>
            <div style="margin-top: 15px; font-size: 14px">
              User stores array of projectIds<br />
              Project stores array of userIds
            </div>
          </div>

          <div class="step-box" style="height: auto">
            <h4>Nested References</h4>
            <p>Todo ‚Üí User ‚Üí Profile</p>
            <div style="margin-top: 15px; font-size: 14px">
              Populate references within references
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Tips -->
      <div class="section">
        <h2>üí° Pro Tips</h2>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
          "
        >
          <div
            style="
              background: #e8f5e8;
              padding: 20px;
              border-radius: 10px;
              border-left: 5px solid #4caf50;
            "
          >
            <h4 style="color: #4caf50">‚úÖ Always Validate</h4>
            <p>
              Check if referenced documents exist before creating relationships
            </p>
          </div>

          <div
            style="
              background: #fff3e0;
              padding: 20px;
              border-radius: 10px;
              border-left: 5px solid #ff9800;
            "
          >
            <h4 style="color: #ff9800">‚ö° Selective Population</h4>
            <p>Only populate fields you need to improve performance</p>
          </div>

          <div
            style="
              background: #e3f2fd;
              padding: 20px;
              border-radius: 10px;
              border-left: 5px solid #2196f3;
            "
          >
            <h4 style="color: #2196f3">üîç Use Indexes</h4>
            <p>Add indexes on reference fields for faster queries</p>
          </div>

          <div
            style="
              background: #fce4ec;
              padding: 20px;
              border-radius: 10px;
              border-left: 5px solid #e91e63;
            "
          >
            <h4 style="color: #e91e63">üö´ Handle Nulls</h4>
            <p>Referenced documents might be deleted - handle null values</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      function showPopulation() {
        const beforeEl = document.getElementById("before-population");
        const afterEl = document.getElementById("after-population");

        // Add highlight animation
        beforeEl.style.transform = "scale(0.95)";
        beforeEl.style.opacity = "0.7";

        setTimeout(() => {
          afterEl.style.transform = "scale(1.05)";
          afterEl.style.boxShadow = "0 8px 25px rgba(76, 175, 80, 0.3)";
          afterEl.style.border = "3px solid #4CAF50";

          setTimeout(() => {
            beforeEl.style.transform = "scale(1)";
            beforeEl.style.opacity = "1";
            afterEl.style.transform = "scale(1)";
            afterEl.style.boxShadow = "0 4px 15px rgba(0,0,0,0.1)";
            afterEl.style.border = "none";
          }, 1500);
        }, 500);
      }

      // Add some interactive highlighting
      document.addEventListener("DOMContentLoaded", function () {
        const referenceId = document.getElementById("reference-id");
        const userDoc = document.getElementById("user-doc");

        setInterval(() => {
          referenceId.style.background =
            "linear-gradient(45deg, #FF6B6B, #FF8E8E)";
          referenceId.style.transform = "scale(1.1)";

          setTimeout(() => {
            userDoc.style.borderColor = "#FF6B6B";
            userDoc.style.boxShadow = "0 4px 15px rgba(255, 107, 107, 0.3)";

            setTimeout(() => {
              referenceId.style.transform = "scale(1)";
              userDoc.style.borderColor = "#e0e0e0";
              userDoc.style.boxShadow = "none";
            }, 1000);
          }, 500);
        }, 4000);
      });
    </script>
  </body>
</html>
